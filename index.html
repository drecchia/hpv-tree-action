<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree Action Component</title>
    <link rel="stylesheet" href="tree-action.css">
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }
        .tree-action-button {
            margin-right: 5px;
        }
        .level-controls {
            display: flex;
            align-items: center;
        }
        .level-input {
            width: 60px;
            margin-right: 10px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <h1>Tree Action Component Example</h1>

    <div id="tree-container">
        <!-- The tree component will be rendered here -->
    </div>

    <script src="tree-action.js"></script>
    <script>
        let treeAction;

        document.addEventListener('DOMContentLoaded', () => {
            // Sample initial data
            const initialTreeData = {
                operations: [
                    { code: 'C', tooltip: 'Create' },
                    { code: 'R', tooltip: 'Read' },
                    { code: 'Rc', tooltip: 'Read Cascade' },
                    { code: 'U', tooltip: 'Update' },
                    { code: 'D', tooltip: 'Delete' },
                    { code: 'S', tooltip: 'Share' },
                ],
                tree: {
                    id: 'root',
                    name: 'Root Folder',
                    isFolder: true,
                    level: 0,
                    operationState: {},
                    availableOperations: ['C', 'R', 'Rc', 'U', 'D', 'S'],
                    lazyLoad: false,
                    loaded: true,
                    children: [
                        {
                            id: 'folder-1',
                            name: 'Project Alpha',
                            isFolder: true,
                            level: 1,
                            operationState: { 'R': 'allowed' },
                            availableOperations: ['C', 'R', 'U', 'D'],
                            lazyLoad: true, // Example of lazy loading
                            loaded: false,
                            children: []
                        },
                        {
                            id: 'file-1',
                            name: 'Document.txt',
                            isFolder: false,
                            level: 1,
                            operationState: { 'R': 'allowed', 'U': 'allowed' },
                            availableOperations: ['R', 'U'],
                            lazyLoad: false,
                            loaded: true
                        },
                        {
                            id: 'folder-2',
                            name: 'Project Beta',
                            isFolder: true,
                            level: 1,
                            operationState: { 'C': 'denied', 'R': 'allowed' },
                            availableOperations: ['C', 'R', 'U', 'D'],
                            lazyLoad: false,
                            loaded: true,
                            children: [
                                {
                                    id: 'file-2',
                                    name: 'Image.jpg',
                                    isFolder: false,
                                    level: 2,
                                    operationState: { 'R': 'allowed' },
                                    availableOperations: ['R'],
                                    lazyLoad: false,
                                    loaded: true
                                }
                            ]
                        }
                    ]
                }
            };

            // Initialize the TreeAction component
            treeAction = new TreeAction({
                containerId: 'tree-container',
                initialData: initialTreeData,
                operations: [ // You can also define operations here if not in initialData
                    { code: 'C', tooltip: 'Create' },
                    { code: 'R', tooltip: 'Read' },
                    { code: 'U', tooltip: 'Update' },
                    { code: 'D', tooltip: 'Delete' },
                    { code: 'S', tooltip: 'Share' } // Added 'Share' operation
                ]
            });

            // Example of attaching a custom state change handler
            treeAction.onStateChange((changeInfo) => {
                const { node, operation, oldState, newState } = changeInfo;
                console.log(`State changed for node "${node.name}" (ID: ${node.id}) operation "${operation}": ${oldState} -> ${newState}`);

                // Example custom logic: If a folder's 'Read' state is set to 'denied',
                // automatically deny 'Read' for all its children.
                if (node.isFolder && operation === 'R' && newState === 'denied') {
                    console.log(`Propagating 'denied' for 'Read' to children of "${node.name}"`);
                    treeAction.propagateToChildren(node, operation, 'denied');
                }

                // Example custom logic: If a child's state changes, update the parent's state
                // (this is already handled by _updateParentOperationState, but you could
                // add more complex logic here if needed).
                if (node.parent) {
                    console.log(`Updating parent state for "${node.parent.name}" after child change`);
                    // treeAction._updateParentOperationState(node.parent, operation); // This is called internally by setOperationState if propagate is true
                }

                // After your custom logic, you might need to re-render if you made changes
                // that the default rendering doesn't pick up immediately.
                // treeAction.render(); // Uncomment if your custom logic requires a re-render
            });

            // Example of adding a new operation type dynamically
            // setTimeout(() => {
            //     treeAction.addNewOperationType('E', 'Execute');
            // }, 3000);

            // Example of removing an operation type dynamically
            // setTimeout(() => {
            //     treeAction.removeOperationType('S');
            // }, 6000);
        });
    </script>

</body>
</html>